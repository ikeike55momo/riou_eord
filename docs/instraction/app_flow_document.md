# App Flow Document

## Onboarding and Sign-In/Sign-Up
When a brand-new user accesses the application, they are immediately greeted by a clean landing page that explains the purpose of the app. This page is kept simple since the app is intended for internal use only by staff members. The user is provided with a login option that uses NextAuth for authentication, allowing for either email link verification or OAuth based methods. The internal login page clearly states that only authorized personnel can access the system and it incorporates trustHost settings to accommodate deployments on Netlify. Users who have forgotten their passwords are guided through a recovery flow where they can request a reset, ensuring that everyone is able to regain access smoothly. In addition, since the app supports both USER and admin roles, the login process distinguishes between these two, enabling appropriate access control once a user successfully signs in.

## Main Dashboard or Home Page
Upon successful authentication, the user is taken to the main dashboard which primarily displays the list of registered facilities. This dashboard is designed with a simple navigation header and a sidebar that might include links to key areas such as facility registration, keyword generation, CSV export, and account settings. The intuitive layout allows the user to clearly see existing facility entries and provides a prominent "新規登録" (New Registration) button to quickly begin entry of new facility information. Depending on the user role, there might also be an administration panel accessible from the dashboard that offers additional management features, thereby segmenting routine operations from higher-level controls. Navigation throughout the app remains consistent, making transitions seamless across different sections of the system.

## Detailed Feature Flows and Page Transitions
After landing on the main dashboard, the user can start by entering detailed facility information. A dedicated facility information form is presented, containing 25 input fields along with an additional field for extra details, ensuring that every aspect of the facility’s profile is fully captured. Once the facility information is submitted, it is saved securely in a Supabase-managed PostgreSQL database. After saving the information, the user is directed to a keyword generation action page. Here, a clearly labeled “キーワード生成” (Keyword Generation) button is available that, when clicked, triggers the AI agent process.

The AI agent, using tools such as Firecrawl combined with frameworks like LangChain or Auto-GPT, automatically crawls the facility’s Google Business Profile and official website to retrieve pertinent data. It then processes this data along with the facility information to generate optimized keywords across three categories: Menu & Services, Environment & Facilities, and Recommended Usage Scenes. Once the AI agent completes the process, the user is taken to a dedicated keyword result page where the generated keywords are displayed in a categorized manner. On this page, the user is given the complete freedom to review each suggested keyword. They can delete mid-process, add new keywords, or even request a re-generation of keywords in case certain suggestions do not meet the requirements. Once satisfied, the user confirms and saves these keywords into the database. If the keyword generation is run more than once for a facility, the new output overwrites the previous data, ensuring that the most recent adjustments are always in effect.

Following the confirmation of keywords, users can opt to export the finalized data into a CSV file. The CSV export functionality compiles detailed information including the facility ID, facility name, the generation timestamp, and comma-separated lists of keywords for each category. This CSV file is designed for seamless integration with the external review generation system where the exported keywords are inserted into predefined prompts in order to automatically craft natural-sounding reviews. Throughout these processes, page transitions are smooth and highly connected, ensuring that from facility input to keyword generation and subsequent CSV export, the user experiences a logical and cohesive sequence of operations.

## Settings and Account Management
Within the app, users can manage their account in a dedicated settings section accessible through the main dashboard. This section allows users to update personal details, change password settings, and adjust notification preferences. For those with administrative permissions, additional options become available such as managing internal user roles and scheduling permissions. Although the app’s primary function focuses on facility management and keyword generation, the account settings are designed to be simple and easily accessible, making it straightforward for internal staff to return back to the main app flow after making any adjustments. The settings interface is built in clear, everyday language and remains consistent with the overall design of the system.

## Error States and Alternate Paths
Throughout the application, careful attention is paid to potential error states and alternate user flows. If the user inputs invalid data into the facility information form, real-time validation alerts them to the necessary corrections. In case there is a connectivity issue during the AI crawling process or when generating keywords, error messages are displayed clearly and the system provides an option to retry the operation without losing the entered facility information. Whenever a user attempts to access a page without the required authorization, they are redirected back to the login page with a message indicating the need for proper credentials. Special error handling related to the Netlify deployment, such as the UntrustedHost error, is also managed in the background through trustHost settings, thus preventing interruption of the normal user flow. These error states and fallback pages ensure that users remain informed and can easily continue their work without major disruptions.

## Conclusion and Overall App Journey
The overall journey through the app starts with a secure and straightforward login process that ushers internal staff into the main dashboard. From this dashboard, users are able to register new facilities with all the necessary details, and kick off an automated AI agent process designed to generate optimized keywords from various data sources. The journey continues as the AI-generated keywords are presented in an actionable format, allowing users to review, edit, and confirm the final output. Once confirmed, the keywords can be exported as a CSV file, ensuring smooth integration with a larger review generation system. The entire flow is supported by robust settings for account management and thoughtful error handling that maintains a steady, cohesive experience. In summary, the application is meticulously designed to guide the user from initial authentication to daily operational tasks in a manner that is clear, efficient, and highly interconnected with each step seamlessly transitioning into the next.